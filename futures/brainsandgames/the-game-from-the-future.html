<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="../../assets/favicon.ico">
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <script src="../../components/nav.js" type="text/javascript" defer></script>
    <script src="../../components/footer.js" type="text/javascript" defer></script>
    <title>The Game from the Future - Brains@Play</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
</head>



<body onload="resetInterface(mods,language)">
<noscript>
    <strong>We're sorry but The Game from the Future doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
</noscript>
<div id="app">
    <!--Navbar-->
    <nav-bar id="nav" class="nav-transparent">
    </nav-bar>

    <div id="tgftf-header" class="header">
        <h1 id="Name0"></h1>
        <h3 id="Description0"></h3>
    </div>

<section id="tgftf">
    <div id="card-game">
        <div id="game-options">
        <div id="language-selection" class="option">
            <div id="language_select">
                <h4 id="language">Language</h4>
                <div class="break"></div>
                <select name="languages"  id="languages" class="select">
                    <option selected>English</option>
                    <option >Ελληνικά</option>
                </select>
            </div>
        </div>
            <div id="mod-selection" class="option">
            <div id="mod_select">
                <h4 id="mod">Choose a Mod</h4>
                <div class="break"></div>
                <select name="mods"  id="mods" class="select">
                </select>
            </div>
            </div>
        <button id="Generate0" class="option" onclick=allQueries(language)></button>
        </div>
        <p id='Prompt'></p>
        <div class="break"></div>
        <div class="card-holder">
            <button class="card" style="background: hsla(80, 100%, 30%, 1); border-color: hsla(99, 39%, 20%, 1);">
                <h3 id="Future0" class ='card-type' style="color: hsla(99, 39%, 20%, 1);" ></h3>
                <div class="break"></div>
                <div class="card-text">
                    <p id="Future1"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(86, 48%, 75%, 1);"><p id='Future'>&nbsp;</p></div>
                    <div class="break"></div>
                    <p id="Future2"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(86, 48%, 75%, 1);"><p id='Time'>&nbsp;</p></div>
                </div>
            </button>
            <button class="card" style="background: hsla(338, 85%, 43%, 1); border-color: hsla(355, 87%, 20%, 1);" >
                <h3 id="Conflict0" class ='card-type' style="color: hsla(355, 87%, 20%, 1);" ></h3>
                <div class="break"></div>
                <div class="card-text">
                    <p id="Conflict1"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(352, 83%, 84%, 1);"><p id='Conflict'>&nbsp;</p></div>
                    <div class="break"></div>
                    <p id="Conflict2"></p>
                    <div class="break"></div>
                    <p >&nbsp;</p>
                </div>
            </button>
            <button class="card" style="background: hsla(297, 27%, 46%, 1); border-color: hsla(296, 29%, 20%, 1);" >
                <h3 id="Players0" class ='card-type' style="color: hsla(296, 29%, 20%, 1);" ></h3>
                <div class="card-text">
                    <p id="Players1"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(294, 29%, 80%, 1);"><p id='Players'>&nbsp;</p></div>
                    <div class="break"></div>
                    <p id="Players2"></p>
                    <div class="break"></div>
                    <p >&nbsp;</p>
                </div>
            </button>
            <button class="card" style="background: hsla(193, 100%, 38%, 1); border-color: hsla(194, 100%, 20%, 1);" >
                <h3 id="Motivation0" class ='card-type' style="color: hsla(194, 100%, 20%, 1);" ></h3>
                <div class="break"></div>
                <div class="card-text">
                    <p id="Motivation1"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(193, 75%, 73%, 1);"><p id='Motivation'>&nbsp;</p></div>
                    <div class="break"></div>
                    <p id="Motivation2"></p>
                    <div class="break"></div>
                    <p >&nbsp;</p>
                </div>
            </button>
            <button class="card" style="background: hsla(35, 100%, 45%, 1); border-color: hsla(35, 98%, 20%, 1);" >
                <h3 id="Location0" class ='card-type' style="color: hsla(35, 98%, 20%, 1);" ></h3>
                <div class="break"></div>
                <div class="card-text">
                    <p id="Location1"></p>
                    <div class="break"></div>
                    <div class="blank" style="background: hsla(36, 100%, 76%, 1);"><p id='Location'>&nbsp;</p></div>
                    <div class="break"></div>
                    <p id="Location2"></p>
                    <div class="break"></div>
                    <p >&nbsp;</p>
                </div>
            </button>
        </div>
        <br/>
        <div class="break"></div>
        <div id="attribution">
        <p id="Creators0" class="left"></p>
        <p id="Attribution0" class="left small"></a></p>
        </div>
    </div>
</section>

    <div id="example-header" class="header">
        <h2 id="exampleName"></h2>
        <h4 id ="exampleDescription"></h4>
    </div>

<section id="example-section">
    <div id="examples">
    </div>
</section>

    <!--Footer-->
    <footer-bar>
    </footer-bar>

</div>

<script>

    let mods = {'Greek':{'General':{
                translation: 'Αρχική',
                overrides: {}
            },
            'VR + Neurotech + Health':{
                translation: 'Εικονική Πραγματικότητα + Νευροτεχνολογία + Υγεία',
                overrides: {
                    'Conflict2': 'παιχνίδι εικονικής πραγματικότητας με διάδραση μεταξύ εγκεφάλων',
                    'Motivation': 'υγεία'}
            }},
        'English':{'General':{
                overrides: {}
            },
            'VR + Neurotech + Health':{
                overrides: { 'Conflict2': 'brain-controlled VR game',
                    'Motivation': 'health'}
            }}
    }

    const langEl = document.getElementById('languages');
    let language = langEl.value;

    let options = Object.keys(mods[language]);
    for (let option in options) {
        if (option == 0) {
            $('#mods').append(`<option selected>` + options[option] + `</option>`)
        } else{
            $('#mods').append(`<option>` + options[option] + `</option>`)
        }
    }

    const modEl = document.getElementById('mods');
    let mod = modEl.value;

    modEl.addEventListener('change', (event) => {
        mod = $('#mods').val()
        reset(mod, mods, language);
    });

    langEl.addEventListener('change', (event) => {
            language = $('#languages').val()
            reset(mod, mods,language);
    });

</script>

<script>
    let myNav = document.getElementById('nav');
    window.onscroll = function () {
        "use strict";
        if (document.body.scrollTop >= 100 || document.documentElement.scrollTop >= 100 ){
            myNav.classList.add("nav-colored");
            myNav.classList.remove("nav-transparent");
        }
        else {
            myNav.classList.add("nav-transparent");
            myNav.classList.remove("nav-colored");
        }
    };
</script>

<script>
    function allQueries(option){
        let all = ['Future-Time','Conflict','Players','Motivation','Location']
        for (const ind in all) {
            queryCSV(all[ind],option)
        }
    }

    const chooseMod = async (mods,language) => {

        let mod_eng;
        let flag = true;

        if (language != 'English'){
            let options = Object.keys(mods[language]);
            // Get English translation of mod
            for (let option in options) {
                if (mods[language][options[option]].translation == mod) {
                    mod_eng = options[option]
                    flag = false;
                }
            }
        } else {
            mod_eng = mod;
        }

        let params = mods[language][mod_eng]

        let overrides = Object.keys(params.overrides);

        let all = ['Future','Time','Conflict','Players','Motivation','Location']

        // Reset cards
        for (let ind in all) {
            [1,2,3].forEach(function(i) {
                if ((i) != 3 && all[ind] != 'Time') {
                    document.getElementById(all[ind] + (i)).className = ''
                } else{
                    document.getElementById(all[ind]).className = ''
                }
            });
        }

        for (let override in overrides){
            document.getElementById(overrides[override]).innerHTML = params.overrides[overrides[override]]
            document.getElementById(overrides[override]).className = 'lock'
        }
    }

    async function reset(mod, mods, language){
        if (language == 'Ελληνικά'){
            language = 'Greek'
        }

        resetInterface(mods,language)
        chooseMod(mods, language)
        allQueries(language)
    }

    function resetInterface(mods,language){

        // Reset Cards and Non-Selector Interface Elements
        let file = '../sheets/interface' + language + '.csv'
        let el;
        d3.csv(file).then(function (data) {
            let headers = Object.keys( data[0] ) // then taking the first row object and getting an array of the keys
            for (const header in headers) {
                document.getElementById(headers[header]+0).innerHTML = data[0][headers[header]];
                if ((headers[header] != "Name" && headers[header] != "Description" && headers[header] != "Generate" && headers[header] != "Creators" && headers[header] != "Attribution")){
                    for (let row=0; row < data.length; row++) {
                        el = document.getElementById(headers[header] + (row))
                        if (el.className != 'lock') {
                            el.innerHTML = data[row][headers[header]];
                        }
                    }
                }
            }})

        populateExamples(language)

        // Reset Language Selector
        let selector = document.getElementById("language-selection")
        if (selector.className != 'remove') {
            if (language == 'Greek') {
                document.getElementById('language').innerHTML = 'Επιλέξτε τη γλώσσα σας'
            } else {
                document.getElementById('language').innerHTML = 'Choose your Language'
            }
        }

        // Reset Mod Selector
        $("#mods").empty()
        if ($("#mod-selection").className != 'remove') {
            if (language == 'Greek') {
                document.getElementById('mod').innerHTML = 'Επιλογή έκδοσης'
            } else {
                document.getElementById('mod').innerHTML = 'Choose a Mod'
            }
        }

        let options = Object.keys(mods[language]);
        let blank;
        let comparison

        // Dynamically generate a new mod selector
        for (let option in options) {

            // Get English translation of selected element
            if (language != 'English'){
                blank = mods[language][options[option]].translation
                if (mods[language][options[option]].translation  == mod){
                    comparison = mods[language][options[option]].translation
                } else{
                    comparison = options[option]
                }
            } else {
                blank = options[option]
                comparison = options[option]
            }

            if (comparison == mod) {
                $('#mods').append(`<option selected>` + blank + `</option>`)
            } else{
                $('#mods').append(`<option>` + blank + `</option>`)
            }
        }
        mod = $('#mods').val()
    }

    function populateExamples(language) {
        if (language == 'Ελληνικά') {
            language = 'Greek'
        }

        let file = '../sheets/examples' + language + '.csv'
        d3.csv(file).then(function (data) {
            let headers = Object.keys(data[0]) // then taking the first row object and getting an array of the keys
            document.getElementById('exampleName').innerHTML = data[0]['Name'];
            document.getElementById('exampleDescription').innerHTML = data[0]['Description'];
            document.getElementById('examples').innerHTML = null;
            for (let game = 0; game < data.length; game++) {
                document.getElementById('examples').innerHTML += "<div class=\"example\">\n" +
                    "            <div class=\"example_text\">\n" +
                    "                <h2>" + data[game]['Game'] + " </h2>\n" +
                    "                <h3>" + data[game]['Creator'] + "</h3>\n" +
                    "                <p class=\"prompt\">" + data[game]['Prompt']+ "</p>\n" +
                    "                <p>" + data[game]['Details'] + "</p>\n" +
                    "            </div>\n" +
                    "            <a href=\"../images/" + data[game]['Game'].replace(/\s/g, '') + ".jpg\" target=\"_blank\">\n" +
                    "                <img alt=data[game]['Game'] src=\"../images/" + data[game]['Game'].replace(/\s/g, '') + ".jpg\">\n" +
                    "            </a>\n" +
                    "        </div>" +
                    "<hr/>"
            }
        })
    }

    function queryCSV(text_id,option) {
        let file_id = ''
        if (option == 'Ελληνικά'){
            option = 'Greek'
        }

        switch(option) {
            case 'Classic':
                switch(text_id){
                    case 'Future-Time':
                        file_id = 'tgftf';
                        break;
                    case 'Conflict':
                        file_id = 'tgftf';
                        break;
                    case 'Players':
                        file_id = 'tgftf';
                        break;
                    case 'Motivation':
                        file_id = 'tgftf';
                        break;
                    case 'Location':
                        file_id = 'tgftf';
                        break;
                }
                break;
            default:
                file_id = 'tgftf';
        }
        let file = '../sheets/' + file_id + option + '.csv'
        d3.csv(file).then(function (data) {
            let flag = true;
            let inner_flag;
            let row;
            let str = text_id.split('-');
            let output;
            let freq;


            if (str.length > 1) {
                for (const col in str) {
                    inner_flag = true;
                    while (inner_flag) {
                        row = Math.floor(Math.random() * data.length);
                        output = data[row][str[col]];
                        if (output != '') {
                            inner_flag = false;
                            if (str[col] == 'Time' && option == 'English') {
                                output += ' from now'
                            }
                            let el = document.getElementById(str[col])
                            if (el.className != 'lock') {
                                el.innerHTML = output;
                            }
                        }
                    }
                }
            } else {

                // Create bag of words (to account for frequency)
                let bag = [];
                let data_;
                let word;
                let components;
                for (const r in data) {
                    data_ = data[r][str[0]]
                    if (data_ != undefined && data_ != []) {
                        if (data_.split(' (').length == 2) {
                            components = data_.split(' (')
                            word = components[0];
                            freq = components[1].split(')')[0]
                            for (let i = 0; i < freq; i++) {
                                bag.push(word)
                            }
                        } else{
                            bag.push(data_)
                        }
                    }
                }

                while (flag) {
                    row = Math.floor(Math.random() * bag.length);
                    output = bag[row]
                    if (output != '') {
                        flag = false;
                        let el = document.getElementById(text_id)
                        if (el.className != 'lock') {
                            el.innerHTML = output;
                            if (text_id == 'Players') {
                                switch (option) {
                                    case 'Ελληνικά':
                                        // switch (output) {
                                        //   case 'one': // 'έναν':
                                        //     document.getElementById('Players2').innerHTML = 'παίκτης';
                                        //     break;
                                        //   default:
                                        document.getElementById('Players2').innerHTML = 'παίκτες';
                                        // break;
                                        break
                                    case 'English':
                                        // switch (output) {
                                        //   case 'one':
                                        //     document.getElementById('Players2').innerHTML = 'player';
                                        //     break;
                                        //   default:
                                        document.getElementById('Players2').innerHTML = 'players';
                                    // break;
                                }
                                break;
                            }
                        }
                    }
                }
            }
            updatePrompt();
        })
    }

    function updatePrompt(){
        let all = ['Future','Conflict','Players','Motivation','Location']
        let text = [];
        for (let ind in all){
            if (ind != undefined){
                if (ind != 4){
                    if (ind == 0) {
                        text.push(document.getElementById(all[ind] + 1).innerHTML)
                    } else{
                        text.push(document.getElementById(all[ind] + 1).innerHTML.toLowerCase())
                    }}
                if (ind != 4) {
                    text.push('<strong>' + document.getElementById(all[ind]).innerHTML + '</strong>')
                } else{
                    text.push('<strong>' + document.getElementById(all[ind]).innerHTML + '</strong>' + '.')
                }

                if (ind != 3) {
                    text.push(document.getElementById(all[ind] + 2).innerHTML)
                }

                if (all[ind] == 'Future'){
                    text.push('<strong>' + document.getElementById('Time').innerHTML + '</strong>' + ",")
                }
                let prompt = text.join(' ')
                document.getElementById('Prompt').innerHTML = prompt
            }}}
</script>

</body>
</html>
