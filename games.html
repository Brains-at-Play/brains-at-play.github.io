<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="assets/favicon.ico">
    <link rel="stylesheet" href="css/style.css">
    <title>Brains@Play | Games</title>
    <script src="components/nav.js" type="text/javascript" defer></script>
    <script src="components/footer.js" type="text/javascript" defer></script>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
</head>
<body onload='displaySubmissions()'>
<div id="app">
    <!--Navbar-->
    <nav-bar id="nav" class="nav-transparent">
    </nav-bar>
    <div id="games-header" class="header">
        <h2>Games List</h2>
    </div>
    <section>
        <div class="content">
        <div id="game"></div>
        <div id="available-games" class='gallery'></div>
        <h2 id="temp-message"></h2>
            <button id="back" style="display:none;">
                Back to Games List
            </button>
        </div>
</section>

    <!--Footer-->
    <footer-bar>
    </footer-bar>
</div>

<script>

    let url = "https://brainsatplay.azurewebsites.net"
    // let url = "http://localhost"

    // Dispay Submissions
    function displaySubmissions(){

        jsonOBJ = {'request': 'all'}

        fetch(url + '/getsubmissions', {
            method: 'POST',
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(jsonOBJ), // body data type must match "Content-Type" header
        }).then(response => {
            let gameTag;
            response.json().then(function (json) {
                Object.keys(json).forEach(function(key) {
                    gameTag = `<div id="${json[key]}" class="item" style="
cursor: pointer;
width: 100%;
padding: 0px 50px;

background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url(${json[key]["game-image"]});
background-position: center;
background-size: cover;
background-attachment: scroll;

"><h3>${key}</h3></div>`
                    $('#available-games').append(gameTag);
                    document.getElementById(`${json[key]}`).addEventListener('click', function() {getSubmissions(key)});
            })
            })
    })
    }

    document.getElementById('back').addEventListener('click', function() {goBack()});

    function goBack() {
        document.getElementById('game').innerHTML = '';
        document.getElementById('back').style.display = 'none';
        document.getElementById('available-games').style.display = 'block';
    }


        // Grab submissions
    function getSubmissions(name) {

        document.getElementById('game').innerHTML = '';
        document.getElementById('available-games').style.display = 'none';
        document.getElementById('temp-message').innerHTML = 'Grabbing files. Please wait...';
        jsonOBJ = {'gamename': name}

        fetch(url + '/getsubmissions', {
            method: 'POST',
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(jsonOBJ), // body data type must match "Content-Type" header
        }).then(response => {
            response.json().then(function (json) {
                document.getElementById('temp-message').innerHTML = '';
                if (json.error){
                        $('#game').prepend('<h1>' + json.error + '</h1>')
                    } else {
                        $('#game').prepend(
                            `

<div>
<div>
<h1 id='game-name'></h1>
<i id='game-pitch'></i>
<br/>
<div id='game-image' class="header"></div>
<div class="center">
    <i id='game-prompt' class="small"></i>
</div>
<p id='game-description'></p>
<h2>Additional Information</h2>
<p id='additional-info'></p>

<h3>The Team</h3>
<h4 id='team-name'></h4>
<p id='team-members'><strong>Members:</strong> </p>
<p id='team-ages'><strong>Ages:</strong> </p>
<p id='team-country'><strong>Country:</strong> </p>
<p class="small" id='contact'>For inquiries, please contact </p>

<h3>Video</h3>
<div id="video-link"></div>
<h3>Additional Images</h3>
<div id='additional-images' class='gallery'>
</div>
<br/>
<h2>Game Details</h2>
<br/>
<h3>How far in the future does your game take place?</h3>
<p id='game-futuretime'></p>
<h3>In what type of future does your game take place?</h3>
<p id='game-futuretype'></p>
<br/>
<h3>How many players?</h3>
<p id="players-number"></p>
<h3>Who are the players?</h3>
<p id="players-characteristics"></p>
<h3>Except human brains, are there other types of brains involved?</h3>
<p id="players-nonhuman"></p>
<h3>Where are players located while playing the game?</h3>
<p id="players-location"></p>
<h3>Why are they playing?</h3>
<p id="players-motivation"></p>
<h3>Which is the main theme of the game?</h3>
<p id="players-theme"></p>
<h3>Where does it take place?</h3>
<p id="players-world"></p>
<br/>
<h3>What kind of conflict does the game support?</h3>
<p id="rules-conflict"></p>
<h3>What players can (or cannot) do?</h3>
<p id="rules-what"></p>
<h3>How they can (or cannot) do it?</h3>
<p id="rules-how"></p>
<h3>What are the win/lose conditionsâ€”-if any?</h3>
<p id="rules-conditions"></p>
<br/>
<h3>What are the major ethical issues that might be raised by the game?</h3>
<p id="ethical-issues"></p>
<h3>Do you have any specific safeguards to protect players against them?</h3>
<p id="ethical-safeguards"></p>
</div>
</div>
`)

                        Object.keys(json).forEach(function(key) {
                            var doc = json[key];

                            document.getElementById("contact").innerHTML+= `${doc['contact-fn']} ${doc['contact-ln']} at ${doc['contact-email']}.`;
                            document.getElementById("game-image").style.backgroundImage=`url(${doc["game-image"]})`;
                            document.getElementById("game-image").style.backgroundPosition=`center`;
                            document.getElementById("game-image").style.backgroundSize=`contain`;
                            document.getElementById("game-image").style.backgroundAttachment=`scroll`;

                            for (let img in doc["additional-images"]){
                                $('#additional-images').prepend('<img class="item" src=' + doc["additional-images"][img] + ' />')
                            }

                            Object.keys(doc).forEach(function(field) {
                                if (!['_id','additional-images', 'game-image','contact-fn','contact-ln','contact-email','competition'].includes(field)) {
                                    document.getElementById(field).innerHTML += doc[field];
                                }
                            })
                        });
                    }
                    document.getElementById('back').style.display = 'block';
                }
            )
        });
    };


</script>


<script>
    let myNav = document.getElementById('nav');
    window.onscroll = function () {
        "use strict";
        if (document.body.scrollTop >= 100 || document.documentElement.scrollTop >= 100 ){
            myNav.classList.add("nav-colored");
            myNav.classList.remove("nav-transparent");
        }
        else {
            myNav.classList.add("nav-transparent");
            myNav.classList.remove("nav-colored");
        }
    };
</script>

</body>
</html>
