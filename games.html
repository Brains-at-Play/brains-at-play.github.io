<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="assets/favicon.ico">
    <link rel="stylesheet" href="css/style.css">
    <title>Brains@Play | Games</title>
    <script src="components/nav.js" type="text/javascript" defer></script>
    <script src="components/footer.js" type="text/javascript" defer></script>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
</head>
<body onload='displaySubmissions()'>
<div id="app">
    <!--Navbar-->
    <nav-bar id="nav" class="nav-transparent">
    </nav-bar>
    <div id="games-header" class="header">
        <h2>Games List</h2>
    </div>
    <section>
        <div class="content">
        <div id="game"></div>
        <div id="available-games"></div>
        <h2 id="temp-message"></h2>
        <div id="back"></div>
        </div>
</section>

    <!--Footer-->
    <footer-bar>
    </footer-bar>
</div>

<script>

    let url = "https://brainsatplay.azurewebsites.net"
    // let url = "http://localhost"

    // Dispay Submissions
    function displaySubmissions(){

        jsonOBJ = {'request': 'all'}

        fetch(url + '/getsubmissions', {
            method: 'POST',
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(jsonOBJ), // body data type must match "Content-Type" header
        }).then(response => {
            // $('#available-games').prepend('<h1>Available Games</h1>')
            let gameTag;
            response.json().then(function (json) {
                Object.keys(json).forEach(function(key) {
                    gameTag = `<a id="${json[key]}" class="link"><h3>${json[key]}</h3></a><i>${key}</i>`
                    $('#available-games').append(gameTag);
                    document.getElementById(`${json[key]}`).addEventListener('click', function() {getSubmissions(json[key])});
            })
            })
    })
    }

    // // Submit to MongoDB
    // $("#SubmitGame").click(function(){
    //     let game = document.getElementById('gameinput').value
    //     $('#submission').empty()
    //     $('#submission').prepend('<h1>' + 'Grabbing files. Please wait...' + '</h1>')
    //     getSubmissions(game)
    // });
    document.getElementById('back').addEventListener('click', function() {goBack()});

    function goBack() {
        document.getElementById('game').innerHTML = '';
        document.getElementById('back').innerHTML = '';
        document.getElementById('available-games').style.display = 'block';
    }


        // Grab submissions
    function getSubmissions(name) {

        document.getElementById('game').innerHTML = '';
        document.getElementById('available-games').style.display = 'none';
        document.getElementById('temp-message').innerHTML = 'Grabbing files. Please wait...';
        jsonOBJ = {'gamename': name}

        fetch(url + '/getsubmissions', {
            method: 'POST',
            mode: 'cors', // no-cors, cors, *same-origin
            cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'omit', // include, *same-origin, omit
            headers: {
                'Content-Type': 'application/json',
            },
            redirect: 'follow', // manual, *follow, error
            referrer: 'no-referrer', // no-referrer, *client
            body: JSON.stringify(jsonOBJ), // body data type must match "Content-Type" header
        }).then(response => {
            response.json().then(function (json) {
                document.getElementById('temp-message').innerHTML = '';
                if (json.error){
                        $('#game').prepend('<h1>' + json.error + '</h1>')
                    } else {
                        $('#game').prepend(
                            "<h1 id='game-name'></h1>"+
                            "<h3 id='team-name'></h1>"+
                            "<i id='team-members'></i>"+
                            "<p id='game-prompt'></p>"+
                            "<p id='game-description'></p>"+
                            "<img id='game-image'>"+
                            "<div id='additional-images'></div>"
                        )

                        Object.keys(json).forEach(function(key) {
                            var doc = json[key];
                            document.getElementById("team-name").innerHTML=doc["team-name"];
                            document.getElementById("team-members").innerHTML=doc["team-members"];
                            document.getElementById("game-name").innerHTML=doc["game-name"];
                            document.getElementById("game-prompt").innerHTML=doc["game-prompt"];
                            document.getElementById("game-description").innerHTML=doc["game-description"];
                            document.getElementById("game-image").src=doc["game-image"];
                            for (img in doc["additional-images"]){
                                $('#additional-images').prepend('<img src=' + doc["additional-images"][img] + ' />')
                            }
                        });
                    }
                document.getElementById('back').innerHTML = 'Go Back';
                }
            )
        });
    };


</script>


<script>
    let myNav = document.getElementById('nav');
    window.onscroll = function () {
        "use strict";
        if (document.body.scrollTop >= 100 || document.documentElement.scrollTop >= 100 ){
            myNav.classList.add("nav-colored");
            myNav.classList.remove("nav-transparent");
        }
        else {
            myNav.classList.add("nav-transparent");
            myNav.classList.remove("nav-colored");
        }
    };
</script>

</body>
</html>
